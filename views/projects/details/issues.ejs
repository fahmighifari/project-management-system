<% include ../../partials/header %>
<% include ../../partials/menu %>

<div class="container" style="float: left; width: 20%">
  <ul class="nav nav-sidebar">
    <li><a href="/projects/details/<%=idURL%>/overview">Overview <span class="sr-only">(current)</span></a></li>
    <li><a href="/projects/details/<%=idURL%>/activity">Activity</a></li>
    <li>&nbsp</li>
  </ul>
  <ul class="nav nav-sidebar">
    <li><a href="/projects/details/<%=idURL%>/members">Members</a></li>
    <li class="activesidebar"><a href="/projects/details/<%=idURL%>/issues">Issues</a></li>
  </ul>
</div>

<div class="container" style="float: right; width: 80%">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Filter</h3>
    </div>
    <div class="panel-body">
      <form method="GET">
        <input type="hidden" name="page" value="<%= pagination.page %>">
        <div class="form-group row">
          <label class="col-sm-2 col-form-label">
            <input class="form-check-input" type="checkbox" name="cid" value="True" <%= query.cid ? " checked" : ""%>>
            ID
          </label>
          <div class="col-sm-10">
            <input class="form-control" type="number" name="id" value="<%= query.id %>"  placeholder="id">
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-2 col-form-label">
            <input class="form-check-input"  type="checkbox" name="csubject" value="True"<%= query.csubject ? " checked" : ""%>>
            Subject
          </label>
          <div class="col-sm-10">
            <input class="form-control" type="text" name="subject"  value="<%= query.subject %>" placeholder="subject">
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-2 col-form-label">
            <input class="form-check-input"  type="checkbox" name="ctracker" value="True"<%= query.ctracker ? " checked" : ""%>>
            Tracker
          </label>
          <div class="col-sm-10">
            <select class="form-control" name="tracker">
              <option value="">Choose the Tracker...</option>
              <option value="Bug">Bug</option>
              <option value="Feature">Feature</option>
              <option value="Support">Support</option>
            </select>
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-2 col-form-label">
            <input class="form-check-input"  type="checkbox" name="cdescription" value="True"<%= query.cdescription ? " checked" : ""%>>
            Description
          </label>
          <div class="col-sm-10">
            <input class="form-control" type="text" name="description"  value="<%= query.description %>" placeholder="description">
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-2 col-form-label">
            <input class="form-check-input"  type="checkbox" name="cstatus" value="True"<%= query.cstatus ? " checked" : ""%>>
            Status
          </label>
          <div class="col-sm-10">
            <select class="form-control" name="status">
              <option value="">Choose a Status...</option>
              <option value="New">New</option>
              <option value="In Progress">In Progress</option>
              <option value="Resolved">Resolved</option>
              <option value="Feedback">Feedback</option>
              <option value="Closed">Closed</option>
              <option value="Rejected">Rejected</option>
            </select>
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-2 col-form-label">
            <input class="form-check-input"  type="checkbox" name="cpriority" value="True"<%= query.cpriority ? " checked" : ""%>>
            Priority
          </label>
          <div class="col-sm-10">
            <select class="form-control" name="priority">
              <option value="">Choose a Priority...</option>
              <option value="Normal">Normal</option>
              <option value="High">High</option>
              <option value="Urgent">Urgent</option>
              <option value="Immediate">Immediate</option>
            </select>
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-2 col-form-label">
            <input class="form-check-input"  type="checkbox" name="casignee" value="True"<%= query.casignee ? " checked" : ""%>>
            Asignee
          </label>
          <div class="col-sm-10">
            <select class="form-control" name="asignee">
              <option value="">Choose an Asignee...</option>
              <% for(let x=0; x<membersData.length; x++) {%>
                <option value="<%= membersData[x].userid %>"><%= membersData[x].name %></option>
                <% } %>
              </select>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-2 col-form-label">
              <input class="form-check-input"  type="checkbox" name="cstartdate" value="True"<%= query.cstartdate ? " checked" : ""%>>
              Start Date
            </label>
            <div class="col-sm-10">
              <input class="form-control" type="date" name="startdate"  value="<%= query.startdate %>">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-2 col-form-label">
              <input class="form-check-input"  type="checkbox" name="cduedate" value="True"<%= query.cduedate ? " checked" : ""%>>
              Due Date
            </label>
            <div class="col-sm-10">
              <input class="form-control" type="date" name="duedate"  value="<%= query.duedate %>">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-2 col-form-label">
              <input class="form-check-input"  type="checkbox" name="cestimatedtime" value="True"  <%= query.cestimatedtime ? " checked" : ""%> >
              Est. Time
            </label>
            <div class="col-sm-10">
              <input class="form-control" type="number" name="estimatedtime"  value="<%= query.estimatedtime %>" placeholder="estimated time">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-2 col-form-label">
              <input class="form-check-input"  type="checkbox" name="cpercentagedone" value="True"<%= query.cpercentagedone ? " checked" : ""%>>
              % Done
            </label>
            <div class="col-sm-10">
              <input class="form-control" type="number" name="percentagedone"  value="<%= query.percentagedone %>" min="0" max="100" placeholder="percentage done">
            </div>
          </div>
          <div class="form-group row">
            <div class="col-sm-10">
              <button type="submit" name="submit" class="btn btn-primary">Search</button>
              <a href="/projects/details/<%=idURL%>/issues" class="btn btn-primary">Reset</a>
            </div>
          </div>
        </form>
      </div>
    </div>


    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Options</h3>
      </div>
      <div class="panel-body">
        <form class="" action="/projects/details/<%=idURL%>/issues/issuescolumn" method="post">
          <div class="form-group row">
            <label class="col-sm-2 control-label">columns</label>
            <div class="col-sm-2">
              <div class="checkbox">
                <label>
                  <input type="checkbox" name="coid" value="true"<%= issuesColumns.coid ? " checked" : ""%>>
                  ID
                </label>
              </div>
              <div class="checkbox">
                <label>
                  <input type="checkbox" name="cosubject" value="true"<%= issuesColumns.cosubject ? " checked" : ""%>>
                  Subject
                </label>
              </div>
              <div class="checkbox">
                <label>
                  <input type="checkbox" name="cotracker" value="true"<%= issuesColumns.cotracker ? " checked" : ""%>>
                  Tracker
                </label>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="checkbox">
                <label>
                  <input type="checkbox" name="codescription" value="true"<%= issuesColumns.codescription ? " checked" : ""%>>
                  Description
                </label>
              </div>

              <div class="checkbox">
                <label>
                  <input type="checkbox" name="costatus" value="true"<%= issuesColumns.costatus ? " checked" : ""%>>
                  Status
                </label>
              </div>
              <div class="checkbox">
                <label>
                  <input type="checkbox" name="copriority" value="true"<%= issuesColumns.copriority ? " checked" : ""%>>
                  Priority
                </label>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="checkbox">
                <label>
                  <input type="checkbox" name="coasignee" value="true"<%= issuesColumns.coasignee ? " checked" : ""%>>
                  Asignee
                </label>
              </div>

              <div class="checkbox">
                <label>
                  <input type="checkbox" name="costartdate" value="true"<%= issuesColumns.costartdate ? " checked" : ""%>>
                  Start Date
                </label>
              </div>
              <div class="checkbox">
                <label>
                  <input type="checkbox" name="coduedate" value="true"<%= issuesColumns.coduedate ? " checked" : ""%>>
                  Due Date
                </label>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="checkbox">
                <label>
                  <input type="checkbox" name="coestimatedtime" value="true"<%= issuesColumns.coestimatedtime ? " checked" : ""%>>
                  Estimated Time
                </label>
              </div>

              <div class="checkbox">
                <label>
                  <input type="checkbox" name="copercentdone" value="true"<%= issuesColumns.copercentdone ? " checked" : ""%>>
                  % Done
                </label>
              </div>
              <div class="checkbox">
                <label>
                  <input type="checkbox" name="coaction" value="true"<%= issuesColumns.coaction ? " checked" : ""%>>
                  Action
                </label>
              </div>
            </div>
          </div>
          <div class="form-group row">
            <div class="col-sm-10">
              <button type="submit" class="btn btn-primary">Apply</button>
            </div>
          </div>
        </form>
      </div>
    </div>


    <table class="table table-striped ">
      <thead>
        <tr>
          <%if(issuesColumns.coid) {%><th>#</th><%}%>
          <%if(issuesColumns.cosubject) {%><th>Subject</th><%}%>
          <%if(issuesColumns.cotracker) {%><th>Tracker</th><%}%>
          <%if(issuesColumns.codescription) {%><th>Description</th><%}%>
          <%if(issuesColumns.costatus) {%><th>Status</th><%}%>
          <%if(issuesColumns.copriority) {%><th>Priority</th><%}%>
          <%if(issuesColumns.coasignee) {%><th>Asignee</th><%}%>
          <%if(issuesColumns.costartdate) {%><th>Start Date</th><%}%>
          <%if(issuesColumns.coduedate) {%><th>Due Date</th><%}%>
          <%if(issuesColumns.coestimatedtime) {%><th>Estimated Time</th><%}%>
          <%if(issuesColumns.copercentdone) {%><th>% Done</th><%}%>
          <%if(issuesColumns.coaction) {%><th>Action</th><%}%>
        </tr>
      </thead>
      <tbody>
        <% if(issuesData.length > 0) { %>
          <%for(var x=0; x<issuesData.length; x++) {%>
            <tr>
              <%if(issuesColumns.coid) {%><td><%= issuesData[x].issueid %></td><%}%>
              <%if(issuesColumns.cosubject) {%><td><%= issuesData[x].subject %></td><%}%>
              <%if(issuesColumns.cotracker) {%><td><%= issuesData[x].tracker %></td><%}%>
              <%if(issuesColumns.codescription) {%><td><%= issuesData[x].description %></td><%}%>
              <%if(issuesColumns.costatus) {%><td><%= issuesData[x].status %></td><%}%>
              <%if(issuesColumns.copriority) {%><td><%= issuesData[x].priority %></td><%}%>
              <%if(issuesColumns.coasignee ) {%>
                <%for(let y = 0; y<membersData.length; y++) {%>
                  <%if(issuesData[x].asignee === membersData[y].userid) {%><td><%= membersData[y].name %></td> <%}%>
                  <%}%>
                  <%}%>
                  <%if(issuesColumns.costartdate) {%><td><%= issuesData[x].startdate %></td><%}%>
                  <%if(issuesColumns.coduedate) {%><td><%= issuesData[x].duedate %></td><%}%>
                  <%if(issuesColumns.coestimatedtime) {%><td><%= issuesData[x].estimatedtime %></td><%}%>
                  <%if(issuesColumns.copercentdone) {%><td><%= issuesData[x].percentagedone %></td><%}%>
                  <%if(issuesColumns.coaction) {%>
                    <td>
                      <a href='/projects/details/<%=idURL%>/issues/edit/<%=issuesData[x].issueid%>' class="btn btn-success">
                        edit
                      </a>
                      <a href="/projects/details/<%=idURL%>/issues/upload/<%=issuesData[x].issueid%>" class="btn btn-info" type="button" name="button">
                        upload
                      </a>
                      <a href='/projects/details/<%=idURL%>/issues/delete/<%=issuesData[x].issueid%>'>
                        <button class="btn btn-danger" type="button" name="button"
                        onclick="return confirm('Are you sure you want to delete this item?')">
                        delete
                      </button>
                      <%}%>
                    </a>
                  </td>
                </tr>
                <% } %>
                <% } else {%>
                  <tr><h1> NOT FOUND </h1></tr>
                  <% }%>
                </tbody>
              </table>

              <a href="/projects/details/<%=idURL%>/issues/new" class="btn btn-primary">Add</a>

<br><br>

            <ul class="pagination">
              <% console.log("this is url on issues.ejs: ", pagination.url) %>
              <% if(pagination.page > 1){ %><li><a href="/projects<%= pagination.url.replace(`/?page=${pagination.page}`, `/?page=${pagination.page - 1}`) %>">Previous</a></li> <% } %>
              <% for(let i = 1; i <= pagination.pages; i++){ %>
                <li class="<%= (pagination.page == i) ? 'active' : ''%>"><a href="/projects<%= pagination.url.replace(`/?page=${pagination.page}`, `/?page=${i}`) %>"><%= i %></a></li>
                <% } %>
                <% if(pagination.pages > pagination.page){ %><li><a href="/projects<%= pagination.url.replace(`/?page=${pagination.page}`, `/?page=${pagination.page + 1}`) %>">Next</a></li> <% } %>
              </ul>
            <br>

            </div>
              <% include ../../partials/footer %>
